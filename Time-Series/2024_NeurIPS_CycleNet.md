# CycleNet: Enhancing Time Series Forecasting through Modeling Periodic Patterns

>领域：时间序列预测  
>发表在：2024 NeurIPS  
>模型名字：CycleNet  
>文章链接：[CycleNet: Enhancing Time Series Forecasting through Modeling Periodic Patterns](https://arxiv.org/abs/2409.18479)  
>代码仓库：[https://github.com/ACAT-SCUT/CycleNet](https://github.com/ACAT-SCUT/CycleNet)  
![20250407171203](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407171203.png)

## 一、研究背景与问题提出

### 1.1 研究现状

数据中潜在的稳定周期性，是进行长期预测的实际基础 [32]。这就是为什么现有模型强调其提取具有长期依赖性特征的能力。诸如Informer [59]、Autoformer [51] 和PatchTST [40] 等模型利用Transformer处理长距离关系的能力来解决长期序列预测（LTSF）任务。ModernTCN [38] 使用大卷积核来增强时间卷积网络（TCNs）捕捉长距离依赖关系的能力，而SegRNN [31] 则通过分段迭代来改进循环神经网络（RNN）方法对长序列的处理。如果一个模型能够准确捕捉长距离依赖关系，它就能从历史长序列中精确提取周期性模式，从而实现更准确的长期预测。

### 1.2 引出思考

然而，如果构建深度复杂模型的唯一目的是更好地从长距离依赖关系中提取周期性特征，那为什么不直接对这些模式进行建模呢？如图1所示，电力数据呈现出明显的每日周期性模式（可能还存在每周模式）。我们可以使用一个全局共享的每日片段来表示电力消耗的周期性模式。通过将这个每日片段重复N次，我们可以连续表示N天电力消耗序列的循环成分。

事实上，利用周期性信息来提高模型预测准确性并非新的概念。众多研究，特别是引入了一系列季节性 - 趋势分解（STD）技术，使模型能够更好地利用周期性信息。诸如Autoformer [51]、FEDformer [60] 和DLinear [56] 等流行模型利用经典的STD方法，将原始时间序列分解为两个等长的子序列：季节性成分和趋势成分，然后分别对它们进行建模。这些经典的STD方法通常使用基本的移动平均（MOV）核进行滑动聚合以获得趋势成分。最近，Leddam [55] 提出用可学习分解（LD）核取代STD中传统的MOV核，从而提升了性能。此外，DEPTS [8] 将序列的周期性视为关于时间的参数化函数，并通过其周期性模块和局部模块逐层学习周期性成分和残差成分。SparseTSF [32] 是另一项近期研究，它利用跨周期稀疏预测技术分离循环和趋势，以极低的成本取得了出色的性能。

## 二、问题剖析与解决策略

基于上述动机，本文首次对数据中的周期性模式进行显式建模，以提高模型在长期序列预测任务中的性能。具体来说，我们提出了残差循环预测（RCF）技术。该技术使用可学习的循环来显式建模时间序列数据中固有的周期性模式，然后预测所建模循环的残差成分。将RCF技术与单层线性层或双层多层感知机（MLP）相结合，就形成了CycleNet，这是一种简单而强大的方法。CycleNet在多个领域都取得了一致的领先性能，并具有显著的效率优势。

本文提出的RCF技术本质上可被视为一种STD方法。它与现有技术的关键区别在于，使用可学习的循环对独立序列中的全局周期性模式进行显式建模。所提出的RCF技术概念简单、计算高效，并且能显著提高预测准确性。进一步提出的CycleNet，将RCF技术与简单的基础架构相结合，是一种基于线性层或MLP的模型，对于时间序列预测而言简单、高效且强大。

### 2.1 解决方法

#### 2.1.1  残差循环预测

![20250407172032](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407172032.png)

RCF技术包括两个步骤：第一步是通过在独立通道内使用可学习的循环来对序列的周期性模式进行建模，第二步是对已建模循环的残差成分进行预测。

**周期性模式建模**：给定具有先验循环长度$W$的$D$个通道，我们首先生成可学习的循环$Q \in \mathbb{R}^{W \times D}$，所有元素初始化为零。这些循环在通道内全局共享，这意味着通过循环复制，我们可以得到与序列$X$相同长度的循环成分$C$。长度为$W$的这些循环$Q$会与用于预测的基础模块一起进行梯度反向传播训练，从而得到学习到的表示（不同于最初初始化的零值），这些表示揭示了序列内部的循环模式。

这里，循环长度$W$取决于数据集的先验特征，应设置为数据集中最大的稳定循环长度。考虑到需要长期预测的场景通常具有显著、明确的循环（例如，电力消耗和交通数据具有明显的每日和每周循环），确定具体的循环长度是可行且直接的。此外，如附录B.2所示，还可以通过自相关函数（ACF）[39] 进一步研究数据集的循环特征。

**残差预测**：对已建模循环的残差成分进行的预测，即残差预测，步骤如下：

1. 从原始输入$x_{t - L + 1:t}$中去除循环成分$c_{t - L + 1:t}$，以获得残差成分$x'_{t - L + 1:t}$。
2. 将$x'_{t - L + 1:t}$输入基础模块，以获得残差成分的预测值$\tilde{x}'_{t + 1:t + H}$ 。
3. 将预测的残差成分$\tilde{x}'_{t + 1:t + H}$ 添加到循环成分$c_{t + 1:t + H}$ 中，得到$\tilde{x}_{t + 1:t + H}$ 。

需要注意的是，由于循环成分$C$是从$Q$的循环复制得到的虚拟序列，我们无法直接得到上述子序列$c_{t - L + 1:t}$ 和$c_{t + 1:t + H}$ 。因此，如图3所示，需要对循环$Q$进行适当的对齐和重复以获得等效子序列：(i) 将$Q$向左移动$t \bmod W$ 个位置得到$Q^{(t)}$ 。这里，$t \bmod W$ 可被视为当前序列样本在$Q$中的相对位置索引。(ii) 将$Q^{(t)}$ 重复$\lfloor L / W \rfloor$ 次，并连接$Q^{(t)}_{0:L \bmod W}$ 。从数学角度，这两个等效子序列可表示为：
$$c_{t - L + 1:t} = [\underbrace{Q^{(t)}, \cdots, Q^{(t)}}_{\lfloor L / W \rfloor}, Q^{(t)}_{0:L \bmod W}]\tag{1}$$
$$c_{t + 1:t + H} = [\underbrace{Q^{(t + L)}, \cdots, Q^{(t + L)}}_{\lfloor H / W \rfloor}, Q^{(t + L)}_{0:H \bmod W}]\tag{2}$$

**基础模块**：原始预测任务被转化为循环残差成分建模，这可以作为常规的序列建模。因此，任何现有的时间序列预测模型都可以用作基础模块。在本文中，我们的目标是提出并研究一种通过对循环进行显式建模（即RCF）来增强时间序列预测的方法。因此，我们选择最基本的基础模块，即单层线性层和双层MLP，形成我们简单而强大的方法CycleNet/Linear和CycleNet/MLP。在此，每个通道使用相同的基础模块并进行参数共享来建模，这也被称为通道独立策略 [13]。

#### 2.1.2 实例归一化

时间序列数据的统计属性，比如均值，常常会随时间变化，这被称为分布偏移。这会导致在历史训练集上训练的模型应用于未来数据时性能不佳。为了解决这个问题，近期研究引入了如RevIN [45,22,26] 这样的实例归一化策略。像iTransformer [37]、PatchTST [40] 和SparseTSF [32] 等主流方法已广泛采用类似技术来提升性能。
为了提高CycleNet的稳健性，我们也采用了类似的可选策略（完整的消融研究见附录C.4）。具体来说，我们在CycleNet的输入和输出步骤之外，从模型的内部表示中去除变化的统计属性：
$$x_{t - L + 1:t} = \frac{x_{t - L + 1:t} - \mu}{\sqrt{\sigma + \epsilon}}\tag{3}$$
$$\tilde{x}_{t + 1:t + H} = \tilde{x}_{t + 1:t + H} \times \sqrt{\sigma + \epsilon} + \mu\tag{4}$$
其中，$\mu$和$\sigma$分别表示输入窗口的均值和标准差，$\epsilon$是一个用于数值稳定性的小常数。这种方法与不含可学习仿射参数的RevIN版本一致 [22]。

#### 2.1.3 损失函数

为了与当前主流方法保持一致，CycleNet默认使用均方误差（MSE）作为损失函数，以确保与其他方法进行公平比较，其公式为：
$$\mathcal{L}oss = \lVert x_{t + 1:t + H} - \tilde{x}_{t + 1:t + H} \rVert^2_2\tag{5}$$

### 2.2 模型结构

## 三、实验验证与结果分析

### 3.1 主要结果

表2展示了CycleNet与其他模型在多变量长期序列预测（LTSF）任务上的比较结果。总体而言，CycleNet取得了领先的性能（交通数据集除外），其中CycleNet/MLP总体排名第一，CycleNet/Linear总体排名第二。由于多层感知机（MLP）相较于线性层具有非线性映射能力，CycleNet/MLP在电力和太阳能等高维数据集（即通道数超过100的数据集）上表现更好。总之，在残差循环预测（RCF）技术的支持下，即使是非常简单基础的模型（即线性层和MLP）也能取得当前最优性能，超越其他深度模型。这充分展示了RCF技术的优势。

![20250407173801](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407173801.png)

此外，我们可以观察到CycleNet在交通数据集上的性能不如iTransformer，iTransformer使用反向Transformer对时间序列数据中的多变量关系进行建模。这是因为交通数据集具有时空特征和时间滞后特征，在某一检测点的交通流量会显著影响相邻检测点的未来数值。在这种情况下，对足够的通道间关系进行建模是必要的，而iTransformer做到了这一点。相比之下，CycleNet独立地对每个通道的时间依赖性进行建模，因此在这种场景中处于劣势。然而，CycleNet在交通数据集上仍然显著优于其他基线模型。

### 3.2 消融研究与分析

**RCF的有效性**：为了研究RCF的有效性，我们在具有显著周期性的两个数据集（电力和交通数据集）上进行了全面的消融实验。结果见表4。

![20250407180359](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407180359.png)

首先，当将基本的线性层和MLP基础模块（默认均采用实例归一化）与RCF技术相结合时，预测准确性有显著提高（约10% - 20%）。这表明CycleNet的成功很大程度上归功于RCF技术，而非基础模块本身或实例归一化策略。总体而言，MLP的性能强于线性层，无论是否应用RCF技术。这表明在使用通道独立策略（跨每个通道共享参数）对高维数据集进行建模时，非线性映射能力是必要的，这与之前的研究发现一致 [26]。
其次，我们进一步验证了RCF是否能提高现有模型的预测准确性，因为RCF本质上是一种即插即用的灵活技术。我们发现，将RCF融入现有的复杂设计、深度堆叠模型（如PatchTST [40] 和iTransformer [37]）中，仍能提高其性能（约5% - 10%）。对于已经采用经典MOV - 基于STD技术的DLinear，加入RCF也能带来约20%的性能提升。这进一步表明了RCF的有效性和可移植性。
然而，我们观察到一个有趣的现象：虽然当PatchTST和iTransformer与RCF结合时平均绝对误差（MAE）降低，但均方误差（MSE）增加。这其中最重要的原因是，RCF的有效性在很大程度上依赖于学习数据集中的历史平均循环，而交通数据集在某些极值点存在异常。我们在附录C.5中对这一现象进行了详细分析，并提出了改进RCF技术的潜在方向。

**不同STD技术的比较**：本文提出的RCF技术本质上是一种更强大的季节性 - 趋势分解（STD）方法。与现有从有限回溯窗口分解周期性（季节性）成分的方法不同，RCF从训练集中学习全局周期性成分。在这里，我们以纯线性模型作为基础模块（不采用任何线性归一化策略），比较RCF与现有STD技术的有效性。比较对象包括Leddam提出的LD [55]、DLinear采用的MOV [56] 以及SparseTSF提出的Sparse技术 [32]。如表5所示，RCF显著优于其他STD方法，特别是在电力和太阳能等具有强周期性的数据集上。相比之下，其他STD方法在纯线性模型上没有显示出显著优势。

![20250407180543](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407180543.png)

原因有以下几点。首先，基于MOV和LD的STD方法通过在回溯窗口内进行滑动聚合来实现趋势估计，这存在固有问题 [27,26]：
（i）移动平均的滑动窗口需要大于季节性成分的最大周期，否则分解可能不完整（尤其是当周期长度超过回溯序列长度时，分解可能无法进行）。
（ii）为了得到等长的移动平均序列，需要在序列样本边缘进行零填充，这会导致序列边缘失真。至于Sparse技术，作为一种轻量级分解方法，它更多依赖于更长的回溯窗口和实例归一化策略来确保足够的性能。
此外，这些在回溯窗口内分离趋势和季节性的方法本质上等同于无约束或弱约束的线性回归 [44]，这意味着在训练完全收敛后，结合这些方法的基于线性的模型理论上等同于纯线性模型。相比之下，RCF技术获得的周期性成分是从训练集中全局估计得到的，使其能够超越有限长度回溯窗口的限制。

**超参数W的影响**：超参数W决定了RCF技术中可学习循环Q的长度。原则上，它必须与数据中最大的主要周期长度匹配，以便正确建模序列中的周期性模式。我们在表6中研究了CycleNet/Linear模型在不同数据集上，W取不同设置时的性能。当将超参数W正确设置为数据集的最大周期长度（即表1中预先推断的周期长度）时，RCF能够发挥显著作用，与设置不正确时相比，性能差距很大。这表明推断并设置正确的W对于RCF正常发挥作用是必要的。此外，当W设置不正确时，模型的性能几乎与完全不使用RCF时相同。这表明即使在最坏的情况下，RCF也不会带来显著的负面影响。

![20250407180656](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407180656.png)

**学习到的周期性模式可视化**：RCF技术的目的是利用可学习的循环Q（初始化为零）对时间序列数据中的周期性模式进行建模。与基础模块共同训练后，循环可以表示序列中固有的周期性模式。图4展示了从不同数据集和通道学习到的不同周期性模式。例如，图4（c）显示了太阳能光伏发电的每日运行模式，而图4（d）展示了交通流量的每周运行模式，特点是工作日早晨交通高峰。从全局序列中学习到的这些周期性模式为预测模型提供了重要的补充信息，特别是当回溯窗口长度有限且在周期较长时可能无法提供足够的循环信息的情况下。

![20250407180715](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407180715.png)

此外，虽然同一数据集中不同通道的周期长度相同，但具体的周期性模式不同，如图4（e - h）所示。特别是，图4（f）展示了家庭用电在工作日的间歇性周期性，而其他通道在各自的通道中显示出相对一致的工作日模式。这凸显了对每个通道的周期性模式分别进行建模的必要性。
总之，这些发现表明RCF技术可以有效地学习时间序列数据中固有的周期性模式，这是CycleNet取得领先性能的关键解释因素。此外，我们在附录C.1中进行了进一步分析，展示了RCF在不同配置下学习到的周期性模式，以更好地说明RCF的工作原理。

**不同回溯长度下的性能表现**：回溯长度决定了可利用的历史信息的丰富程度。理论上，回溯长度越大，模型性能应该越好，特别是对于能够捕捉长期依赖关系的模型。图5展示了不同模型在不同回溯长度下的性能。可以观察到，CycleNet以及当前领先模型的代表，如iTransformer [37]、PatchTST [40] 和DLinear [56]，在回溯长度较长时都能取得更好的性能。这表明这些模型在建模长期依赖关系方面都具有较强的能力。
值得强调的是：（i）在电力数据集上，CycleNet在任何预测长度下都优于当前领先模型；（ii）在交通数据集上，与现有的强大多变量预测模型（如iTransformer）相比，CycleNet仍有不足。这表明在具有强周期性但没有额外时空关系的场景中，充分利用周期性成分足以实现高精度预测。然而，在需要对变量间关系进行全面建模的更复杂场景中，像CycleNet这样结合简单通道独立策略和基本基础模块的模型仍难以完全满足需求。因此，在附录C.5中，我们进一步分析了当前RCF技术在时空场景（如交通领域）中的局限性，并指出了未来改进的潜在方向。最后，我们还在附录 C.2 中提供了 CycleNet 与现有模型在完整数据集上使用更长的回溯窗口的比较。

![20250407180756](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407180756.png)

## 四、讨论

**潜在局限性**：CycleNet在具有显著且明确周期性模式的长期序列预测（LTSF）场景中展现出了有效性。然而，CycleNet存在一些潜在局限性，在此值得探讨：

- **周期长度不稳定**：CycleNet可能不适用于周期长度（或频率）随时间变化的数据集，如心电图（ECG）数据，因为CycleNet只能学习固定长度的周期。
- **通道间周期长度不同**：当数据集中不同通道呈现出不同的周期长度时，CycleNet可能会面临挑战。因为CycleNet默认对所有通道使用相同的周期长度$W$。鉴于CycleNet的通道独立建模策略，一种可能的解决方案是根据周期长度对数据集进行预处理，将其分割成不同部分，或者将每个通道独立作为一个数据集进行建模。
- **显著异常值的影响**：在存在显著异常值的数据集内，CycleNet的性能可能会受到影响。这是因为RCF的基本工作原理是学习数据集中的历史平均周期。当存在显著异常值时，RCF学习到的周期中某一点的均值可能会被夸大，从而导致对周期性成分和残差成分的不准确估计，进而影响预测过程。
- **长距离周期建模**：RCF技术对于建模中距离稳定周期（如每日或每周周期）是有效的。然而，考虑更长的依赖关系（如年度周期）时，RCF技术面临更大挑战。虽然理论上CycleNet的$W$可以设置为年度周期长度来建模年度周期，但最大的困难在于收集足够长的历史数据来训练一个完整的年度周期，这可能需要数十年的数据。在这种情况下，未来的研究需要开发更先进的技术来专门处理长距离周期建模问题。

**未来工作：进一步建模通道间关系**：RCF技术增强了模型对时间序列数据中周期性进行建模的能力，但并未明确考虑多个变量之间的空间关系。在一些时空场景中，变量之间的时空依赖关系至关重要。例如，近期如iTransformer [37] 和SOFTS [12] 等研究表明，适当建模通道间关系可以提高交通场景下的性能。然而，直接将RCF技术应用于iTransformer并没有带来显著的性能提升（至少对于均方误差指标而言），如表4所示。我们认为设计一种合理且有意义的多变量建模方法，将两者结合起来，具有很大的前景和价值，我们将在未来对此进行探索。
