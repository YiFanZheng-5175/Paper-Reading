# TimeMixer: Decomposable Multiscale Mixing for Time Series Forecasting  

>领域：时间序列预测  
>发表在：2024 ICLR  
>模型名字：TimeMixer  
>文章链接：[TimeMixer: Decomposable Multiscale Mixing for Time Series Forecasting](https://openreview.net/pdf?id=7oLshfEIC2)  
>代码仓库：[https://github.com/kwuking/TimeMixer](https://github.com/kwuking/TimeMixer)  
![20250403174257](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250403174257.png)

## 一、研究背景与问题提出

### 1.1 研究现状

作为时间序列分析中的关键问题（吴等人，2023a），时间建模已得到广泛研究。根据基础骨干网络的不同，深度模型大致可分为以下四种范式：基于循环神经网络（RNN）、基于卷积神经网络（CNN）、基于Transformer以及基于多层感知机（MLP）的方法。通常，基于CNN的模型沿时间维度使用卷积核来捕捉时间模式（王等人，2023；赫瓦格等人，2020）。而基于RNN的方法采用循环结构对时间状态转移进行建模（赖等人，2018；赵等人，2017 ）。然而，基于RNN和CNN的方法都存在感受野有限的问题，这限制了它们的长期预测能力。最近，得益于全局建模能力，基于Transformer的模型在长期序列预测中得到了广泛认可（周等人，2021；吴等人，2021；刘等人，2022b；基塔耶夫等人，2020；聂等人，2023 ），这类模型可以通过注意力机制自适应地捕捉长期时间依赖关系。此外，多层投影（MLP）也被引入到时间序列预测中（奥列什金等人，2019；查卢等人，2023；曾等人，2023 ），在预测性能和效率方面都取得了良好的成果。

此外，人们还提出了一些特定的设计，以更好地捕捉复杂的时间模式，包括序列分解和多周期性分析。首先，在序列分解方面，Autoformer（吴等人，2021）提出了基于移动平均的序列分解模块，将复杂的时间变化分解为季节性和趋势成分。之后，FEDformer（周等人，2022b）通过多内核移动平均增强了序列分解模块。DLinear（曾等人，2023）将序列分解作为线性回归前的预处理步骤。MICN（王等人，2023）也将输入序列分解为季节性和趋势项，然后整合全局和局部上下文信息进行预测。在多周期性分析方面，N - BEATS（奥列什金等人，2019）使用多个三角基函数拟合时间序列。FiLM（周等人，2022a）将时间序列投影到勒让德多项式空间，其中不同的基函数对应于原始序列中的不同周期成分。最近，TimesNet（吴等人，2023a）采用傅里叶变换将时间序列映射到具有不同周期长度的多个成分，并提出了一种模块化架构来处理分解后的成分。

除上述设计外，我们进一步观察到时间序列在不同采样尺度下呈现出不同的时间变化。例如，按小时记录的交通流量会呈现出一天中不同时段的交通变化，而对于按日采样的序列，这些细粒度变化会消失，但与节假日相关的波动会显现。另一方面，宏观经济的趋势主导着年度平均模式。这些观测自然引出一种多尺度分析范式，用于拆解复杂的时间变化，其中细粒度和粗粒度尺度分别反映微观和宏观信息。特别是对于时间序列预测任务，信息变化是由多个尺度共同决定的。因此，在本文中，我们尝试从多尺度混合这一全新视角设计预测模型，该模型能够同时利用解耦后的变化以及多尺度序列的互补预测能力。

## 二、问题剖析与解决策略

### 2.1 解决方法

从技术层面来讲，我们提出了TimeMixer，它具有多尺度混合架构，能够通过过去可分解混合（PDM）模块从过去变化中提取关键信息，然后通过未来多预测器混合（FMM）模块预测未来序列。具体而言，TimeMixer首先通过平均下采样生成多尺度观测。接下来，PDM采用可分解设计，通过分别在从细到粗和从粗到细方向上混合分解后的多尺度季节性和趋势成分，更好地处理具有不同特性的季节性和趋势变化。凭借这一全新设计，PDM能够成功地从最细粒度序列开始聚合详细的季节性信息，并结合来自较粗粒度尺度的知识深入挖掘宏观趋势成分。在预测阶段，FMM集成多个预测器，以利用多尺度观测中的互补预测能力。

#### 2.1.1 多尺度混合架构

![20250403174257](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250403174257.png)

不同尺度的时间序列自然呈现出不同特性，其中细尺度主要刻画详细模式，粗尺度则突出宏观变化（莫泽，1991）。这种多尺度视角本质上能够将复杂变化拆解为多个成分，进而有助于时间变化建模。同样值得注意的是，尤其是对于预测任务而言，多尺度时间序列由于其主导的时间模式不同，呈现出不同的预测能力（费雷拉等人，2006）。因此，我们提出的TimeMixer采用多尺度混合架构，在过去信息提取和未来预测阶段采用不同设计来利用多尺度序列。

如图1所示，为了解耦复杂变化，我们首先通过平均池化将过去观测值$\mathbf{x} \in \mathbb{R}^{P \times C}$下采样至$M$个尺度，最终得到一组多尺度时间序列$\mathcal{X} = \{\mathbf{x}_0, \cdots, \mathbf{x}_M\}$，其中$\mathbf{x}_m \in \mathbb{R}^{\lfloor\frac{P}{2^m}\rfloor \times C}$ ，$m \in \{0, \cdots, M\}$ ，$C$表示变量数量。最低层序列$\mathbf{x}_0 = \mathbf{x}$为输入序列，包含最精细的时间变化，而最高层序列$\mathbf{x}_M$则对应宏观变化。然后，我们通过嵌入层将这些多尺度序列投影为深度特征$\mathcal{X}^0$ ，形式化表示为$\mathcal{X}^0 = \text{Embed}(\mathcal{X})$ 。通过上述设计，我们得到了输入序列的多尺度表示。

接下来，我们使用堆叠的过去可分解混合（PDM）模块来混合不同尺度的过去信息。对于第$l$层，输入为$\mathcal{X}^{l - 1}$ ，PDM的过程可形式化表示为：
$$\mathcal{X}^l = \text{PDM}(\mathcal{X}^{l - 1}), l \in \{0, \cdots, L\}, \quad (1)$$
其中$L$为总层数，$\mathcal{X}^l = \{\mathbf{x}_0^l, \cdots, \mathbf{x}_M^l\}$ ，$\mathbf{x}_m^l \in \mathbb{R}^{\lfloor\frac{P}{2^m}\rfloor \times d_{\text{model}}}$表示具有$d_{\text{model}}$个通道的混合过去表示。下一节将详细介绍PDM的更多细节。

在未来预测阶段，我们采用未来多预测器混合（FMM）模块来整合提取的多尺度过去信息$\mathcal{X}^L$并生成未来预测，即：
$$\hat{\mathbf{x}} = \text{FMM}(\mathcal{X}^L), \quad (2)$$
其中$\hat{\mathbf{x}} \in \mathbb{R}^{F \times C}$代表最终预测结果。通过上述设计，TimeMixer能够成功地从解耦后的多尺度观测中捕捉关键过去信息，并借助多尺度过去信息预测未来。

#### 2.1.2 PAST DECOMPOSABLE MIXING

我们观察到，对于过去的观测值，由于现实世界时间序列的复杂性，即使是最粗粒度尺度的序列也呈现出混合变化。如图1所示，顶层的序列仍然同时呈现出明显的季节性和趋势性。值得注意的是，在时间序列分析中，季节性和趋势成分具有不同的特性（克利夫兰等人，1990），分别对应于短期和长期变化，或平稳和非平稳动态。因此，我们没有直接整体混合多尺度序列，而是提出了过去可分解混合（PDM）模块，分别在多个尺度上混合分解后的季节性和趋势成分。

具体来说，对于第$l$个PDM模块，我们首先使用来自Autoformer（吴等人，2021）的序列分解模块，将多尺度时间序列$\mathcal{X}_l$分解为季节性部分$\mathcal{S}^l = \{ \mathbf{s}_0^l, \cdots, \mathbf{s}_M^l\}$和趋势部分$\mathcal{T}^l = \{ \mathbf{t}_0^l, \cdots, \mathbf{t}_M^l\}$ 。正如前面分析的，考虑到季节性和趋势部分的不同特性，我们分别对季节性和趋势项应用混合操作，以实现多尺度信息的交互。总体而言，第$l$个PDM模块可以形式化表示为：
$$
\mathbf{s}_m^l, \mathbf{t}_m^l = \text{SeriesDecomp}(\mathbf{x}_m^l), m \in \{0, \cdots, M\},
$$
$$
\mathcal{X}^l = \mathcal{X}^{l - 1} + \text{FeedForward} \left( \text{S-Mix} \left( \{ \mathbf{s}_m^l \}_{m = 0}^M \right) + \text{T-Mix} \left( \{ \mathbf{t}_m^l \}_{m = 0}^M \right) \right), \quad (3)
$$
其中$\text{FeedForward}(\cdot)$包含两个带有中间GELU激活函数的线性层，用于通道间的信息交互，$\text{S-Mix}(\cdot)$、$\text{T-Mix}(\cdot)$分别表示季节性和趋势混合。

![20250405160741](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250405160741.png)

**季节性混合** 在季节性分析中（博克斯和詹金斯，1970），较大的周期可以看作是较小周期的聚合，例如交通流量的每周周期是由七个日变化形成的，这说明了详细信息在预测未来季节性变化中的重要性。因此，在季节性混合中，我们采用自下而上的方法，将较低层细粒度尺度时间序列的信息向上整合，这可以为较粗粒度尺度的季节性建模补充详细信息。从技术上讲，对于多尺度季节性部分集合$\mathcal{S}^l = \{ \mathbf{s}_0^l, \cdots, \mathbf{s}_M^l\}$ ，我们对第$m$个尺度使用自下而上混合（Bottom-Up-Mixing）层以残差方式实现自下而上的季节性信息交互，其形式化表示为：
$$
\text{for } m: 1 \to M \text{ do: } \mathbf{s}_m^l = \mathbf{s}_m^l + \text{Bottom-Up-Mixing}(\mathbf{s}_{m - 1}^l). \quad (4)
$$
其中$\text{Bottom-Up-Mixing}(\cdot)$由两个沿时间维度带有中间GELU激活函数的线性层实例化，其输入维度为$\lfloor \frac{P}{2^{m - 1}} \rfloor$ ，输出维度为$\lfloor \frac{P}{2^m} \rfloor$ 。直观理解可参考图2。

**趋势混合** 与季节性部分相反，对于趋势项，详细的变化可能会在捕捉宏观趋势时引入噪声。需要注意的是，较高层的粗粒度尺度时间序列比较低层更容易提供清晰的宏观信息。因此，我们采用自上而下的混合方法，利用较粗粒度尺度的宏观知识来指导较细粒度尺度的趋势建模。

从技术上讲，对于多尺度趋势成分$\mathcal{T}^l = \{ \mathbf{t}_0^l, \cdots, \mathbf{t}_M^l\}$ ，我们对第$m$个尺度采用自上而下混合（Top-Down-Mixing）层以残差方式实现自上而下的趋势信息交互：
$$
\text{for } m: (M - 1) \to 0 \text{ do: } \mathbf{t}_m^l = \mathbf{t}_m^l + \text{Top-Down-Mixing}(\mathbf{t}_{m + 1}^l), \quad (5)
$$
其中$\text{Top-Down-Mixing}(\cdot)$是两个带有中间GELU激活函数的线性层，其输入维度为$\lfloor \frac{P}{2^{m + 1}} \rfloor$ ，输出维度为$\lfloor \frac{P}{2^m} \rfloor$ ，如图2所示。

受季节性和趋势混合的赋能，PDM逐步从细到粗聚合详细的季节性信息，并借助较粗粒度尺度的先验知识深入挖掘宏观趋势信息，最终实现过去信息提取中的多尺度混合。

#### 2.1.3 未来多预测器混合

经过$L$个PDM模块后，我们得到多尺度过去信息$\mathcal{X}^L = \{ \mathbf{x}_0^L, \cdots, \mathbf{x}_M^L \}$，$\mathbf{x}_m^L \in \mathbb{R}^{\lfloor \frac{P}{2^m} \rfloor \times d_{\text{model}}}$ 。由于不同尺度的序列呈现出不同的主导变化，它们的预测能力也有所不同。为了充分利用多尺度信息，我们提议聚合多尺度序列的预测结果，并提出未来多预测器混合模块，其表示为：
$$
\hat{\mathbf{x}}_m = \text{Predicto}_m(\mathbf{x}_m^L), m \in \{0, \cdots, M\}, \hat{\mathbf{x}} = \sum_{m = 0}^M \hat{\mathbf{x}}_m, \quad (6)
$$
其中$\hat{\mathbf{x}}_m \in \mathbb{R}^{F \times C}$代表第$m$个尺度序列的未来预测，最终输出为$\hat{\mathbf{x}} \in \mathbb{R}^{F \times C}$ 。$\text{Predicto}_m(\cdot)$表示第$m$个尺度序列的预测器，它首先采用单个线性层，从长度为$\lfloor \frac{P}{2^m} \rfloor$的提取过去信息直接回归长度为$F$的未来信息（见图2），然后将深度表示投影到$C$个变量中。需要注意的是，FMM是多个预测器的集成，不同的预测器基于不同尺度的过去信息，这使得FMM能够整合混合多尺度序列的互补预测能力。

### 2.2 模型结构

![20250403174257](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250403174257.png)

## 三、实验验证与结果分析

### 3.1 模型分析

**消融实验**  为验证TimeMixer各组件的有效性，我们在全部18个实验基准数据集上，针对过去可分解混合模块和未来多预测器混合模块中的每一种可能设计，进行了详细的消融研究。从表5中，我们有以下发现：

在消融实验②中，去除未来多预测器混合会导致模型在短期和长期预测中的预测准确率显著下降。这表明，混合多尺度序列的未来预测结果能够有效提升模型性能。

![20250405161707](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250405161707.png)

对于过去混合部分，我们通过逐步去除或替换组件来验证其有效性。在消融实验③和④中，分别去除季节性混合和趋势混合，也会导致性能下降。这说明仅依靠季节性或趋势信息交互不足以实现准确预测。此外，在消融实验⑤和⑥中，我们对季节性和趋势部分采用了相同的混合方法，但这并不能带来更好的预测性能。在消融实验⑦中，采用与我们设计相反的混合策略时，也出现了类似情况。这些结果证明了我们自下而上的季节性混合和自上而下的趋势混合设计的有效性。同时，在消融实验⑧和⑨中，我们选择去除分解架构并直接混合多尺度序列。然而，没有了分解操作，无论是自下而上还是自上而下的混合方法都无法取得良好性能，这表明将季节性 - 趋势分离混合是必要的。此外，在消融实验⑩中，去除整个过去可分解混合模块会导致模型预测性能严重下降。上述发现突显了合适的过去混合方法对模型最终性能的重大影响。从时间序列的内在规律出发，TimeMixer在过去信息提取中展现了最佳的混合方法。

**季节性和趋势混合可视化**  为直观理解PDM，我们在图3（a） - （b）中对季节性混合和趋势混合的时间线性权重进行了可视化。我们发现，季节性和趋势项呈现出不同的混合特性，其中季节性混合层呈现出周期性变化（（a）中重复的蓝线），而趋势混合层主要由局部聚合主导（（b）中占主导的对角黄线）。这也验证了对季节性和趋势项采用单独混合技术的必要性。此外，图3（c）展示了细粒度（尺度0）和粗粒度（尺度3）下季节性和趋势项的预测情况。我们可以观察到，细粒度的季节性项和粗粒度的趋势项对准确预测至关重要。这一观察结果为我们在季节性项采用自下而上混合、在趋势项采用自上而下混合的设计提供了依据。

![20250405161956](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250405161956.png)

**多预测器可视化**  为直观理解多尺度序列的预测能力，我们绘制了不同尺度的预测结果以进行定性比较。图4（a）展示了带有未来多预测器混合模块的模型整体预测情况，结果表明通过混合尺度能根据未来变化实现准确预测。为研究每个单独尺度的作用，我们在图4（b） - （e）中展示了每个尺度的预测结果。具体而言，细粒度尺度时间序列的预测结果更关注时间序列的详细变化，能更精确地捕捉季节性模式。相比之下，如图4（c） - （e）所示，经过多次下采样，粗粒度尺度序列的预测更关注宏观趋势。上述结果也突显了未来多预测器混合在利用多尺度序列互补预测能力方面的优势。

![20250405162156](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250405162156.png)

**效率分析**  我们在图5中，将TimeMixer在训练阶段的运行内存和时间与最新的先进模型进行了比较。结果表明，对于各种序列长度（从192到3072），TimeMixer在GPU内存和运行时间方面都始终展现出良好的效率，同时在长期和短期预测任务中也始终保持先进的性能。

![20250405162228](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250405162228.png)

**尺度数量分析**  我们在图6中探究了不同序列长度下，尺度数量（$M$）的影响。具体来说，当预测长度较短时，随着$M$的增加，性能提升幅度会下降。相反，对于较长的预测长度，随着$M$的增加，性能提升更为显著。因此，为平衡性能和效率，我们将长期预测的$M$设为3，短期预测的$M$设为1 。

![20250405162317](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250405162317.png)
