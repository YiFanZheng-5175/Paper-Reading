# ModernTCN: A Modern Pure Convolution Structure for General Time Series Analysis

>领域：时间序列预测  
>发表在：ICLR 2024  
>模型名字：ModernTCN  
>文章链接：[ModernTCN: A Modern Pure Convolution Structure for General Time Series Analysis](https://openreview.net/forum?id=vpJMJerXHU)  
>代码仓库：[https://github.com/luodhhh/ModernTCN](https://github.com/luodhhh/ModernTCN)  
![20250407184101](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407184101.png)

## 一、研究背景与问题提出

### 1.1 研究现状

时间序列分析在众多领域有着广泛应用，如工业预测（Zhou等人，2021）、缺失值插补（Friedman，1962）、动作识别（Ye和Keogh，2009）以及异常检测（Xu等人，2021） 。鉴于其巨大的实际价值，近年来时间序列分析发展迅速（Wen等人，2022；Lim和Zohren，2021）。其中，基于Transformer的方法和基于多层感知器（MLP）的模型的兴起尤为引人注目（Nie等人，2023；Zhang和Yan，2023；Zhou等人，2022；Cirstea等人，2022；Wu等人，2021；Liu等人，2021a；Li等人，2019b；Kitaev等人，2020；Vaswani等人，2017 （Li等人，2023b；Zhang等人，2022；Zeng等人，2022））。但与此同时，基于卷积的模型长期以来受到的关注较少。

在时间序列分析中使用卷积并非易事，因为它需要在效率和性能之间取得更好的平衡。追溯到2010年代，时序卷积网络（TCN）及其变体（Bai等人，2018；Sen等人，2019）在许多时间序列任务中被广泛应用。但到了2020年代，情况发生了变化。基于Transformer的模型和基于MLP的模型迅速兴起，并在近年来取得了令人瞩目的性能。由于它们具有全局有效的感受野（ERF），能够更好地捕捉长期时间（跨时间）依赖关系，因此相比传统的TCN有显著优势。结果是，基于卷积的模型由于其有限的感受野，如今正逐渐失去优势。

先前的一些基于卷积的模型（Wang等人，2023；Liu等人，2022a）试图将卷积重新带回时间序列分析领域。但它们主要侧重于设计额外复杂的结构来配合传统卷积，却忽略了更新卷积本身的重要性。而且它们仍然无法达到与基于Transformer和基于MLP的先进模型相媲美的性能。背后的原因可以通过图1来解释。扩大感受野是将卷积重新带回时间序列分析的关键。但先前基于卷积的模型的感受野仍然有限，这阻碍了它们性能的进一步提升。如何在时间序列分析中更好地使用卷积仍然是一个具有挑战性的开放问题。

作为卷积广泛应用的另一个领域，计算机视觉（CV）在探索卷积方面走了一条截然不同的道路。与时间序列领域的近期研究不同，计算机视觉领域的最新研究侧重于优化卷积本身，并提出了现代卷积（Liu等人，2022d；Ding等人，2022；Liu等人，2022b）。现代卷积是受Transformer启发的一种新卷积范式。

![20250407184324](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407184324.png)

具体来说，现代卷积模块借鉴了Transformer模块的部分架构设计。因此，它具有与Transformer模块类似的结构（图2（a）和（b））。为了与Transformer中的全局感受野相匹配，现代卷积通常采用大卷积核，因为它可以有效地扩大感受野（图1）。现代卷积的有效性已在计算机视觉领域得到证明，尽管时间序列领域对此关注甚少。基于上述发现，我们首先尝试在时间序列分析中对卷积进行现代化改造，看看是否能扩大感受野并带来性能提升。

此外，卷积也是捕捉跨变量依赖关系的一种潜在有效方式。除了跨时间依赖关系外，跨变量依赖关系是时间序列中的另一种关键依赖关系。它指的是多变量时间序列中变量之间的依赖关系。早期研究（Lai等人，2018b）已经尝试使用变量维度上的卷积来捕捉跨变量依赖关系。尽管其性能目前并不具有竞争力，但它仍然证明了卷积在捕捉跨变量依赖关系方面的可行性。因此，有理由相信，经过适当的改进和优化，卷积可以成为捕捉跨变量依赖关系的高效且有效的方法。

## 二、问题剖析与解决策略

基于上述动机，我们在时间序列领域选择了一条较少被探索的道路，成功地将基于卷积的模型带回到时间序列分析中。具体而言，我们对传统的TCN进行现代化改造，并进行一些与时间相关的修改，使其更适合时间序列任务。作为成果，我们提出了一种现代纯卷积结构，即ModernTCN，以有效地利用时间序列中的跨时间和跨变量依赖关系。我们在五个主流时间序列分析任务上评估ModernTCN，包括长期和短期预测、插补、分类和异常检测。令人惊讶的是，作为一个纯基于卷积的模型，ModernTCN在这些任务上均取得了与先进水平相当的性能。同时，ModernTCN还保持了基于卷积模型的效率优势，从而在效率和性能之间实现了更好的平衡。

### 2.1 解决方法

#### 2.1.1 一维卷积模块现代化

![20250407184324](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407184324.png)

遵循Liu等人（2022d）的思路，我们首先如图2（b）所示重新设计一维卷积模块。深度可分离卷积（DWConv）负责在每个特征基础上学习token之间的时间信息，其作用与Transformer中的自注意力模块相同。卷积前馈网络（ConvFFN）类似于Transformer中的前馈网络（FFN）模块。它由两个逐点卷积（PWConv）组成，并采用倒置瓶颈结构，其中ConvFFN模块的隐藏通道比输入通道宽r倍。该模块用于独立学习每个token的新特征表示。

上述设计实现了时间信息和特征信息混合的分离。DWConv和ConvFFN各自仅在时间维度或特征维度之一上混合信息，这与传统卷积同时在两个维度上混合信息不同。这种解耦设计可以使目标任务更易于学习，并降低计算复杂度。

基于上述设计，我们借鉴计算机视觉领域的成功经验，对一维卷积进行现代化改造。但我们发现，单纯以计算机视觉领域的方式对卷积进行现代化改造，对时间序列任务的性能提升微乎其微。事实上，上述设计没有考虑到时间序列的特性。除了特征维度和时间维度外，时间序列还有一个变量维度。但是如图2（b）中所设计的卷积模块，无法正确处理变量维度。因为在多变量时间序列中存在跨变量相关性（Zhang和Yan，2023；Li等人，2023b），所以仍需要进行更多与时间序列相关的修改，以使现代一维卷积更适合时间序列分析。

#### 2.1.2 与时间序列相关的修改

**保持变量维度**：

在计算机视觉中，在骨干网络之前，我们将3通道的RGB特征嵌入到每个像素中，通过嵌入层将RGB通道的信息混合到一个D维向量中。但简单的变量混合嵌入（例如，将M个变量简单地映射到每个时间步的D维向量）并不适用于时间序列。首先，变量之间的差异在时间序列中通常比图像通道之间的差异大得多（Cirstea等人，2022）。仅靠一个嵌入层无法学习变量之间的复杂依赖关系，甚至会因为忽略变量不同的行为而丢失变量的独立特征。其次，这种嵌入设计导致丢弃了变量维度，使其无法进一步研究跨变量依赖关系。针对这个问题，我们提出了分块变量独立嵌入方法。

我们将$X_{in} \in \mathbb{R}^{M \times L}$表示为长度为L的M个变量输入时间序列，并在填充后（填充细节见附录B）将其进一步划分为N个大小为P的块。块的步长S也作为两个连续块之间不重叠区域的长度。然后，这些块将被嵌入到D维嵌入向量中：

$X_{emb} = Embedding(X_{in})$  (1)

$X_{emb} \in \mathbb{R}^{M \times D \times N}$是输入嵌入。与先前的研究（Nie等人，2023；Zhang和Yan，2023）一致，我们以等效的全卷积方式进行这种分块嵌入，以简化实现。在对$X_{in} \in \mathbb{R}^{M \times 1 \times L}$进行解压缩后，我们将$X_{in}$映射到一个内核大小为P、步长为S的一维卷积层中，使得该层将1个输入通道映射到D个输出通道。在上述过程中，M个单变量时间序列中的每一个都是独立嵌入的。因此，我们可以保持变量维度。并且通过以下修改，我们的结构能够捕捉来自额外变量维度的信息。

**深度可分离卷积（DWConv）**：

DWConv最初是为学习时间信息而设计的。由于仅通过DWConv联合学习跨时间和跨变量依赖关系难度较大，因此将DWConv修改为负责仅通过变量维度混合信息是合适的。因此，我们将原始的仅特征独立的DWConv修改为特征和变量都独立，使其分别独立学习每个单变量时间序列的时间依赖性。并且我们采用大内核的DWConv来扩大感受野，提高时间建模能力。

**卷积前馈网络（ConvFFN）**：

由于DWConv是特征和变量独立的，ConvFFN应该作为补充，在特征和变量维度上混合信息。一种简单的方法是通过单个ConvFFN联合学习特征和变量之间的依赖关系。但这种方法会导致更高的计算复杂度和较差的性能。因此，我们将单个ConvFFN分解为ConvFFN1和ConvFFN2，方法是将PWConv替换为分组PWConv，并为它们设置不同的组数量。ConvFFN1负责学习每个变量的新特征表示，而ConvFFN2负责捕捉每个特征的跨变量依赖关系。

经过上述修改后，我们得到了如图2（d）所示的最终ModernTCN模块。DWConv、ConvFFN1和ConvFFN2中的每一个都仅在时间、特征或变量维度之一上混合信息，这体现了现代卷积解耦设计的思想。

![20250407184101](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407184101.png)

### 2.2 模型结构

嵌入操作之后，$X_{emb}$ 被输入到骨干网络中，以捕捉跨时间和跨变量依赖关系，并学习信息量丰富的表示 $Z \in \mathbb{R}^{M \times D \times N}$：
$$ Z = Backbone(X_{emb}) \tag{2}$$

Backbone(·) 是堆叠的ModernTCN模块。每个ModernTCN模块都采用残差结构（He等人，2015）。第 $i$ 个ModernTCN模块的前向传播过程如下：
$$ Z_{i + 1} = Block(Z_i) + Z_i \tag{3}$$

其中 $Z_i \in \mathbb{R}^{M \times D \times N}$，$i \in \{1, \ldots, K\}$ 是第 $i$ 个模块的输入，
$$ Z_i = \begin{cases}
X_{emb} &, i = 1 \\
Block(Z_{i - 1}) + Z_{i - 1} &, i > 1
\end{cases} \tag{4}$$

Block(·) 表示ModernTCN模块。最终的表示 $Z = Block(Z_K) + Z_K$ 将进一步用于多种时间序列分析任务。有关每个任务的流程，请参见附录B。

## 三、实验验证与结果分析

### 3.1 有效感受野（ERF）分析

扩大有效感受野是将卷积重新应用于时间序列分析的关键。在本节中，我们将从有效感受野的角度讨论为什么ModernTCN比先前基于卷积的模型性能更优。首先，与其他传统时序卷积网络（2018）不同，ModernTCN不是通过堆叠更多层来扩大有效感受野，而是通过增大卷积核大小来实现。在纯卷积结构中，增大卷积核大小是扩大有效感受野更有效的方法。根据纯卷积模型中有效感受野的理论（Luo等人，2016），有效感受野与$O(ks\times\sqrt{nl})$ 成正比，其中$ks$和$nl$分别指卷积核大小和层数。有效感受野随卷积核大小线性增长，而随层数呈亚线性增长。因此，通过增大卷积核大小，ModernTCN可以轻松获得更大的有效感受野，进而提升性能。

![20250407213653](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407213653.png)

除了增大卷积核大小和堆叠更多层之外，时间序列领域先前的一些基于卷积的方法（MICN（2023）和SCINet（2022a））更倾向于采用一些复杂结构与传统卷积配合，试图扩大它们的有效感受野。由于它们不是纯卷积结构，很难从理论上分析其有效感受野。因此，我们将这些方法的有效感受野可视化以便直观比较。按照Kim等人（2023）的做法，我们从ETTh1验证集中采样50个长度为336的输入时间序列用于可视化。其背后的思路是可视化输入序列中有多少点能对最终特征图的中间点产生贡献。如图1所示，我们的方法相比先前基于卷积的方法能获得大得多的有效感受野。因此，我们的方法能更好地释放卷积在时间序列中的潜力，并在多个时间序列分析任务中成功提升性能。

### 3.2 消融实验

#### ModernTCN模块设计消融实验
为验证我们在ModernTCN模块中设计的有效性，我们在长期预测任务中进行消融实验。结果见表4。丢弃变量维度无法提供理想性能，这证实了我们的观点，即单纯以计算机视觉领域的方式对卷积进行现代化改造，由于忽略了变量维度的重要性，无法带来性能提升。为更好地处理变量维度，我们在设计中将单个ConvFFN解耦为ConvFFN1和ConvFFN2。如表4所示，未解耦的ConvFFN性能最差，而我们解耦后的两个ConvFFN（ConvFFN1 + ConvFFN2）组合性能最佳，这证明了我们对ConvFFN模块解耦修改的必要性和有效性。更多细节见附录H。

![20250407213740](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407213740.png)

#### 跨变量组件消融实验
作为我们设计中一项重要的与时间序列相关的修改，我们将ConvFFN2设计为跨变量组件，用于捕捉跨变量依赖关系。我们在插补任务和异常检测任务中进行消融实验。如表5所示，在这两个任务中，没有ConvFFN2会导致严重的性能下降，这凸显了跨变量依赖关系在时间序列分析中的重要性。

![20250407213814](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250407213814.png)
