# Periodicity Decoupling Framework for Long-term Series Forecasting

>领域：时间序列预测  
>发表在：ICLR 2024  
>模型名字：**P**eriodicity **D**ecoupling **F**ramework  
>文章链接：[Periodicity Decoupling Framework for Long-term Series Forecasting](https://openreview.net/pdf?id=dp27P5HBBt)  
>代码仓库：[https://github.com/Hank0626/PDF](https://github.com/Hank0626/PDF)  
![20250403135418](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250403135418.png)

## 一、研究背景与问题提出

### 1.1 研究现状

现有的基于深度学习（DL）的方法主要直接聚焦于一维时间变化建模，这在时间序列预测中起着关键作用。其中，基于卷积神经网络（CNN）的方法（Bai等人，2018；Wang等人，2022；Wu等人，2023）已展现出捕捉短期变化的强大能力。例如，时序卷积网络（TCN）（Bai等人，2018）通过利用卷积运算纳入时间序列沿时间维度的局部信息，并在中短期预测中表现出卓越性能。然而，由于对长期依赖关系的表示能力有限，这类方法通常在长期时间序列预测中效果不佳。相比之下，基于Transformer的方法（Li等人，2019；Zhou等人，2021；Wu等人，2021）因使用自注意力机制而擅长捕捉长期依赖关系 。例如，Autoformer（Wu等人，2021）尝试利用自相关机制挖掘序列级时间依赖关系。PatchTST（Nie等人，2023）提出一种新颖的分块策略，以保留每个分块内的局部语义信息。尽管基于Transformer的方法比基于CNN的方法表现出更具竞争力的性能，但它们往往计算成本高昂，尤其是对于长期时间序列输入，这限制了其实际应用。

值得考虑的是，由于涉及复杂模式，一维时间变化建模可能是一项复杂任务。这些变化形式多样，包括短期波动、下降和上升，且往往相互重叠（见图1a）。尽管存在这些挑战，研究人员在该领域尚未取得显著进展，如何有效建模时间变化仍是一个悬而未决的问题。不过，需要注意的是，现实世界中的时间序列通常表现出多周期性，如每日和每周变化，这在交通流量预测中已得到证实（Wu等人，2023）。此外，长期时间序列可根据预定周期进行简化或解耦。例如，如图1a所示，原始时间序列可解耦为短期序列和长期序列，分别包含短期变化和长期依赖关系。考虑到这些观察结果，我们可以利用周期信息来解耦长期时间序列。

## 二、问题剖析与解决策略

### 2.1 解决方法

![20250403135718](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250403135718.png)

基于上述观察，我们提出一种新颖的周期性解耦框架（PDF）用于长期序列预测，通过捕捉时间序列内部复杂的周期信息。基于序列的周期性，原始一维时间序列可进一步解耦为更简单的短期和长期序列，分别代表一维时间序列的局部变化和全局相关性。由于短期变化（如波动、上升和下降）的多样性，我们采用“频率切片”方法，将对应的不同周期划分为多个子序列，以进行回溯窗口分析。对于长期变化，我们使用“周期分块”来提取不同周期对应时间段内的变化（见图1a）。“周期分块”确保每个分块包含丰富的长期语义信息。

![20250403135418](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250403135418.png)

从技术层面讲，我们提出一种新颖的周期性解耦框架（PDF）用于长期时间序列预测。如图2所示，我们的PDF包含三个主要组件：多周期解耦模块（MDB）、双变化建模模块（DVM B）和变化聚合模块（VAB）。与以往专注于一维时间变化建模的方法不同，我们的PDF对二维时间变化进行建模。具体而言，多周期解耦模块首先根据输入序列的周期频率将一维时间序列解耦为不同的短期和长期一维序列，然后通过丰富的短期和长期变化信息进一步将其重塑为二维张量。之后，双变化建模模块尝试从解耦的二维张量中捕捉短期和长期变化，接着由变化聚合模块进行最终预测。对我们PDF的扩展实验表明，在各种长期时间序列数据集上，无论是预测性能还是计算效率，其在长期时间序列预测方面都达到了当前最优水平。值得注意的是，如图1b所示，我们的PDF在不牺牲计算成本（仅24个分块）的情况下，比其他基于Transformer的方法更好地处理回溯窗口为960的长期序列。

#### 2.1.1 多周期解耦模块

多周期解耦模块使用周期性提取器和基于周期的重塑器将一维时间序列转换到二维空间。然后，它利用时间变化解耦器通过“周期分块”和“频率切片”来解耦长期和短期信息。

![20250403154227](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250403154227.png)

**周期性提取器**：先前的研究（Wu等人，2023）强调，时间序列的原始一维结构仅不足以表示相邻时间点的变化，而二维结构可以有效地捕捉周期内和周期间的变化。因此，对于给定的维度为$d$的一维输入$\mathbf{X}_I \in \mathbb{R}^{t \times d}$ ，我们采用快速傅里叶变换（FFT）（Chatfield，1981）在频域中对时间序列进行如下分析：
$$\mathbf{A} = \text{Avg}(\text{Amp}(\text{FFT}(\mathbf{X}_I)))\tag{1}$$
这里，FFT和Amp分别表示快速傅里叶变换和幅度提取。对$d$个通道进行通道方向的平均操作Avg得到$\mathbf{A} \in \mathbb{R}^{t}$ ，表示$t$个频率的幅度。具体来说，第$j$个值$\mathbf{A}_j$表示频率$f$的周期基函数的强度。在后续计算中，我们使用单变量$X_I \in \mathbb{R}^{t}$ 而不是$\mathbf{X}_I$来表示输入时间序列，因为后续的变换和预测是以通道独立的方式进行的（Zheng等人，2014；Nie等人，2023）。

其中，A代表了每个频率分量的强度。然后对于频率的选择，研究者认为不仅要考虑强度最大的几个频率，还需要考虑频率取值最大的频率。因为前者反映了序列的主要组成部分，后者代表了序列的高频变化部分。所以，研究者选取了图片中强度前 m 大的频率。并在 m 个频率中，进一步选取了强度前 图片 大的频率，并在剩下的频率中选取了频率值前 图片 大的频率（保证 k1+k2<m ）：

$$\mathbf{F}_u = \underset{f_* \in \{1, \dots, \lfloor \frac{t}{2} \rfloor\}}{\arg \text{top-}m} (\mathbf{A}), \mathbf{F}_{k_1} = \underset{f_* \in \{1, \dots, \lfloor \frac{t}{2} \rfloor\}}{\arg \text{top-}k_1} (\mathbf{A}), \{f_1, \cdots, f_k\} = \mathbf{F}_{k_1} \cup \text{top-}k_2(\mathbf{F}_u \setminus \mathbf{F}_{k_1})\tag{2}$$
其中$\mathbf{F}_u$和$\mathbf{F}_{k_1}$分别表示从$\mathbf{A}$中幅度最高的$u$个和$k_1$个频率。我们确保$u$大于或等于$k_1$ 。由于频域中的共轭对称性，$f_*$仅关注前$\lfloor \frac{t}{2} \rfloor$个频率。最终的$k$个频率集由$\mathbf{F}_{k_1}$和从$\mathbf{F}_u \setminus \mathbf{F}_{k_1}$中选出的数值最大的$k_2$个频率组成。

**基于周期的重塑器**：基于选定的频率$\{f_1, \cdots, f_k\}$和相应的周期长度$\{p_1, \cdots, p_k\}$（$p_i = \lceil \frac{t}{f_i} \rceil$ ），我们通过以下方式将一维输入序列$X_I \in \mathbb{R}^{t}$重塑为$k$个二维张量：
$$X_{2\text{D}}^i = \text{Reshape}_{f_i, p_i}(\text{Padding}(X_I)), \quad i \in \{1, \cdots, k\}\tag{3}$$
这里，$\text{Padding}(\cdot)$用于通过填充零将$X_I$的长度扩展到$p_i \times f_i$ ，以便进行$\text{Reshape}_{f_i, p_i}(\cdot)$操作，其中$f_i$和$p_i$分别表示二维张量的行数和列数。对于得到的二维张量$X_{2\text{D}}^i \in \mathbb{R}^{f_i \times p_i}$ ，每行表示短期变化，每列表示长期变化。然后，我们使用时间变化解耦器通过“周期分块”和“频率切片”来解耦长期和短期信息。

**周期分块**：将分块长度记为$p$，步长记为$s$，我们沿着$p_i$维度划分$X_{2\text{D}}^i \in \mathbb{R}^{f_i \times p_i}$ ，并沿着$f_i$维度聚合以形成一个分块。具体来说，$X_{2\text{D}}^i$被划分为多个分块$x_{g}^{i,j} \in \mathbb{R}^{N \times P}$ ，其中$N = \lfloor \frac{(p_i - p)}{s} \rfloor + 1$是分块数量，每个分块包含$P = f_i \times p$个时间步。$x_{g}^{i,j}$表示第$j$个分块。这种分块策略浓缩了所有周期之间完整的长期变化。

与先前的分块策略（Nie等人，2023；Zhang和Yan，2023）相比，我们的分块捕获了更广泛的范围和更丰富的语义信息，增强了Transformer对长期变化进行建模的能力。同时，由于分块数量从$t/s$减少到$\max(p_i)/s$ ，计算成本显著降低。

**频率切片**：沿着$f_i$维度，我们将$X_{2\text{D}}^i$分割为多个一维短期切片$x_{l}^{i,r} \in \mathbb{R}^{p_i}$ ，其中$r \in [1, f_i]$表示$X_{2\text{D}}^i$的第$r$行。每个局部切片表示每个周期内的短期变化。

#### 2.1.2 双变化建模模块

![20250403155212](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250403155212.png)

如图4所示，双变化建模模块由两部分组成：长期变化提取器和短期变化提取器。它采用双分支并行架构对时间序列中的长期和短期变化进行建模。这种并行结构不仅能更好地保留短期变化的高频信息，还能提高计算效率（Wang等人，2022；Si等人，2022）。以下将详细介绍每个组件。

**长期变化提取器**：对于包含长期信息的分块$x_{g}^{i,j} \in \mathbb{R}^{N \times P}$ ，我们首先通过线性投影将其投影到潜在空间：$x_{g}^{i,j} = \text{Linear}(x_{g}^{i,j}) \in \mathbb{R}^{N \times D}$ ，其中$D$是潜在空间的维度。随后，$x_{g}^{i,j}$将经过多个Transformer编码器层。每层的具体过程如下：
$$\hat{x}_{g}^{i,j} = \text{BatchNorm}(x_{g}^{i,j} + \text{MSA}(x_{g}^{i,j}, x_{g}^{i,j}, x_{g}^{i,j}))\tag{4}$$
$$\tilde{x}_{g}^{i,j} = \text{BatchNorm}(\hat{x}_{g}^{i,j} + \text{MLP}(\hat{x}_{g}^{i,j}))$$
这里，$\text{BatchNorm}(\cdot)$表示批量归一化（Ioffe和Szegedy，2015） 。$\text{MLP}(\cdot)$是一个多层线性前馈神经网络。多头自注意力$\text{MSA}(\cdot)$机制通过使用多个独立的自注意力头来增强表示能力。每个头捕捉不同分块之间不同类型的长期依赖关系。通过以下方式将所有这些头组合起来以获得更全面的依赖关系：
$$X_{g}^{i} = \text{Linear}(\text{Flatten}(\tilde{x}_{g}^{i,j})) \in \mathbb{R}^{t}\tag{5}$$

**短期变化提取器**：该模块包含一系列卷积块，每个卷积块由一个一维卷积层和一个非线性激活函数组成。这些块按顺序构建，以逐渐扩大感受野，适应不同长度的周期。对于每个局部切片$x_{l}^{i,r}$ ，每个块的处理过程如下：
$$\hat{x}_{l}^{i,r} = \text{SELU}(\text{Conv1d}(x_{l}^{i,r}))\tag{6}$$
其中SELU表示缩放指数线性单元（Klambauer等人，2017）。为了得到卷积部分的最终预测，我们使用拼接和截断操作：
$$X_{l}^{i} = \text{Truncate}(\text{Concat}(\hat{x}_{l}^{i,r}))\tag{7}$$

双变化建模模块的最终输出是$X_{g}^{i}$和$X_{l}^{i}$的和：
$$\hat{X}^{i} = X_{g}^{i} + X_{l}^{i}\tag{8}$$

#### 2.1.3 变化聚合模块

变化聚合模块整合来自$k$个双变化建模模块（DVMB）的结果。具体来说，我们将这$k$个结果拼接起来，然后通过一个参数共享的线性层进行映射，以生成单变量预测$X_O \in \mathbb{R}^{T}$ ：
$$X_O = \text{Linear}(\text{Concat}(\hat{X}^{i}))\tag{9}$$

最终的多变量预测$\mathbf{X}_O \in \mathbb{R}^{T \times d}$是通过堆叠$d$个单变量预测$X_O$得到的。

### 2.2 模型结构

![20250403135418](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250403135418.png)

## 三、实验验证与结果分析

### 3.1 周期分块的有效性

**分块信息分析**：近期研究（Nie等人，2023；Lin等人，2023；Zhang等人，2023）指出，增强分块内的语义信息可提升预测效果。为评估强调更多语义信息的分块与强调长期信息的分块的性能，我们开展如下对比实验：1）PatchTST(336)：依循原始PatchTST实验设定，我们将每个分块长度$p = 16$ ，步长$s = 8$ ，共得42个分块；2）PatchTST(336)*：我们设定$p = 64$ ，$s = 14$ ，得到24个分块。与PatchTST(336)相比，每个分块更长，涵盖更多语义信息。3）PDF(336)：我们采用单周期分块，周期长度$p_1 = 24$ ，选取$p = s = 1$ 。鉴于$f_1 = 336 / p_1 = 14$ ，每个分块长度为$p \times f_1 = 14$ 。这产生24个分块，每个分块富含长期信息。

![20250403155643](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250403155643.png)

表2中的实验结果显示，与PatchTST(336)和PatchTST(336)*相比 ，PDF(336)在多数数据集上展现出显著的性能提升。这些发现凸显了分块内所含长期信息的重要性。值得注意的是，PatchTST(336)*和PDF(336)的分块数量相同。尽管PatchTST(336)*中的每个分块更长，理论上预示着更好的预测结果，但它的性能并未提升，在某些情况下甚至比PatchTST(336)更差。这进一步表明，仅扩展分块内的语义信息不足以增强预测效果。关键在于确保每个分块捕捉更多长期信息，而我们的周期分块方法能有效解决这一问题。

![20250403155743](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250403155743.png)

**效率分析**：为进一步验证我们的周期分块方法的计算效率，我们开展实验，对比PDF与另外两种基于分块的方法在不同回溯窗口$t \in \{336, 512, 720, 960\}$和预测长度$T \in \{96, 192, 336, 720\}$下的乘累加运算（MACs）（Cao等人，2022） 。结果汇总于表3。总体而言，与PatchTST相比，PDF的MACs减少了34.64%，与Crossformer相比减少了74.38%。对于固定的回溯窗口$t$ ，PDF的MACs随预测长度$T$增加而增加，通常在数百万级别，而对于PatchTST和Crossformer则在数十亿级别。在保持预测长度不变并增加回溯窗口大小时，也有相同的观察结果。在极端情况下，特别是对于$t = 960$且$T = 720$的ETTh1数据集，PDF展现出卓越的轻量性能，与PatchTST和Crossformer相比，MACs分别减少了54.12%和99.71%。

### 3.2 消融研究

![20250403155935](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250403155935.png)

**卷积模块**：为探究卷积在短期变化建模中的影响，我们开展研究，对比以下三种情况：1）并行卷积；2）顺序卷积；3）无卷积。我们在四个数据集上进行这些比较。表4中的结果显示，并行卷积始终优于顺序卷积 ，这一优势可能源于串行架构中更深网络带来的训练挑战。有趣的是，无卷积模型比使用顺序卷积的模型效果更好，突显了过深串行网络的弊端。此外，与无卷积模型相比，并行方法在周期性较弱的数据集上实现了显著的性能提升，证明了它在不增加网络深度的情况下保留短期信息的有效性。在如Traffic等强周期性数据集上观察到的性能下降，强调了关注跨周期长期变化的必要性。

![20250403160059](https://picgo-for-paper-reading.oss-cn-beijing.aliyuncs.com/img/20250403160059.png)

**变化聚合方法**：我们探索在变化聚合模块中聚合多个双变化建模模块（DVMB）输出的两种方法：1）拼接（Concat）：拼接所有DVMB的输出，并通过线性投影进行映射；2）均值（Mean）：计算所有DVMB输出的平均值。这两种聚合策略的实验结果见表5，结果表明拼接操作（Concat）通常比均值操作（Mean）性能更好。
